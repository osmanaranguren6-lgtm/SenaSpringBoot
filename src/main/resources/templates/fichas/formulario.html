<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(titulo=${accion + ' Ficha'}, contenido=~{::main})}"
      lang="es">
<body>
    <main>
        <!-- Encabezado -->
        <div class="mb-4">
            <h2>
                <i th:class="${ficha.id == null ? 'bi bi-card-list' : 'bi bi-pencil-fill'} + ' text-primary'"></i>
                <span th:text="${accion} + ' Ficha'">Crear Ficha</span>
            </h2>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a th:href="@{/}">Inicio</a></li>
                    <li class="breadcrumb-item"><a th:href="@{/fichas}">Fichas</a></li>
                    <li class="breadcrumb-item active" th:text="${accion}">Crear</li>
                </ol>
            </nav>
        </div>

        <!-- Formulario -->
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card border-0 shadow">
                    <div class="card-header card-header-sena">
                        <h5 class="mb-0">
                            <i class="bi bi-clipboard-data-fill"></i> Información de la Ficha
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <form th:action="@{/fichas/guardar}"
                              th:object="${ficha}"
                              method="post"
                              novalidate>

                            <!-- ID oculto (para edición) -->
                            <input type="hidden" th:field="*{id}">

                            <div class="row g-3">
                                <!-- Número de Ficha -->
                                <div class="col-md-6">
                                    <label for="codigo" class="form-label">
                                        Número de Ficha <span class="text-danger">*</span>
                                    </label>
                                    <input type="text"
                                           class="form-control"
                                           th:field="*{codigo}"
                                           th:classappend="${#fields.hasErrors('codigo')} ? 'is-invalid' : ''"
                                           id="codigo"
                                           placeholder="2530001"
                                           required>
                                    <div class="invalid-feedback" th:if="${#fields.hasErrors('codigo')}" th:errors="*{codigo}">
                                        Error de código
                                    </div>
                                </div>

                                <!-- Programa -->
                                <div class="col-md-6">
                                    <label for="programaId" class="form-label">
                                        Programa de Formación <span class="text-danger">*</span>
                                    </label>
                                    <select class="form-select"
                                            name="programaId"
                                            id="programaId"
                                            required>
                                        <option value="">Seleccione un programa</option>
                                        <option th:each="programa : ${programas}"
                                                th:value="${programa.id}"
                                                th:text="${programa.codigo + ' - ' + programa.nombre}"
                                                th:selected="${ficha.programa != null && ficha.programa.id == programa.id}">
                                            Programa
                                        </option>
                                    </select>
                                    <div class="invalid-feedback">
                                        Debe seleccionar un programa
                                    </div>
                                </div>

                                <!-- Fecha de Inicio -->
                                <div class="col-md-6">
                                    <label for="fechaInicio" class="form-label">
                                        Fecha de Inicio <span class="text-danger">*</span>
                                    </label>
                                    <input type="date"
                                           class="form-control"
                                           th:field="*{fechaInicio}"
                                           th:classappend="${#fields.hasErrors('fechaInicio')} ? 'is-invalid' : ''"
                                           id="fechaInicio"
                                           required>
                                    <div class="invalid-feedback" th:if="${#fields.hasErrors('fechaInicio')}" th:errors="*{fechaInicio}">
                                        Error de fecha de inicio
                                    </div>
                                </div>

                                <!-- Fecha de Fin -->
                                <div class="col-md-6">
                                    <label for="fechaFin" class="form-label">
                                        Fecha de Fin <span class="text-danger">*</span>
                                    </label>
                                    <input type="date"
                                           class="form-control"
                                           th:field="*{fechaFin}"
                                           th:classappend="${#fields.hasErrors('fechaFin')} ? 'is-invalid' : ''"
                                           id="fechaFin"
                                           required>
                                    <div class="invalid-feedback" th:if="${#fields.hasErrors('fechaFin')}" th:errors="*{fechaFin}">
                                        Error de fecha de fin
                                    </div>
                                </div>

                                <!-- Jornada -->
                                <div class="col-md-6">
                                    <label for="jornada" class="form-label">
                                        Jornada <span class="text-danger">*</span>
                                    </label>
                                    <select class="form-select"
                                            th:field="*{jornada}"
                                            th:classappend="${#fields.hasErrors('jornada')} ? 'is-invalid' : ''"
                                            id="jornada"
                                            required>
                                        <option value="">Seleccione una jornada</option>
                                        <option value="DIURNA">Diurna</option>
                                        <option value="NOCTURNA">Nocturna</option>
                                        <option value="MIXTA">Mixta</option>
                                        <option value="FINES_DE_SEMANA">Fines de Semana</option>
                                    </select>
                                    <div class="invalid-feedback" th:if="${#fields.hasErrors('jornada')}" th:errors="*{jornada}">
                                        Error de jornada
                                    </div>
                                </div>

                                <!-- Estado -->
                                <div class="col-md-6">
                                    <label for="estado" class="form-label">
                                        Estado
                                    </label>
                                    <select class="form-select"
                                            th:field="*{estado}"
                                            id="estado">
                                        <option value="ACTIVA">Activa</option>
                                        <option value="INACTIVA">Inactiva</option>
                                        <option value="FINALIZADA">Finalizada</option>
                                        <option value="SUSPENDIDA">Suspendida</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Botones -->
                            <div class="d-flex justify-content-between mt-4 pt-3 border-top">
                                <a th:href="@{/fichas}" class="btn btn-secondary">
                                    <i class="bi bi-x-circle"></i> Cancelar
                                </a>
                                <button type="submit" class="btn btn-sena">
                                    <i class="bi bi-save-fill"></i>
                                    <span th:text="${ficha.id == null ? 'Crear Ficha' : 'Guardar Cambios'}">Guardar</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Validación del formulario
        (function() {
            'use strict';
            var forms = document.querySelectorAll('form[novalidate]');
            Array.prototype.slice.call(forms).forEach(function(form) {
                form.addEventListener('submit', function(event) {
                    if (!form.checkValidity()) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        })();
    </script>
</body>
</html>
