<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(titulo=${accion + ' Programa'}, contenido=~{::main})}"
      lang="es">
<body>
    <main>
        <!-- Encabezado -->
        <div class="mb-4">
            <h2>
                <i th:class="${programa.id == null ? 'bi bi-book' : 'bi bi-pencil-fill'} + ' text-primary'"></i>
                <span th:text="${accion} + ' Programa'">Crear Programa</span>
            </h2>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a th:href="@{/}">Inicio</a></li>
                    <li class="breadcrumb-item"><a th:href="@{/programas}">Programas</a></li>
                    <li class="breadcrumb-item active" th:text="${accion}">Crear</li>
                </ol>
            </nav>
        </div>

        <!-- Formulario -->
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card border-0 shadow">
                    <div class="card-header card-header-sena">
                        <h5 class="mb-0">
                            <i class="bi bi-clipboard-data-fill"></i> Información del Programa
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <form th:action="@{/programas/guardar}"
                              th:object="${programa}"
                              method="post"
                              novalidate>

                            <!-- ID oculto (para edición) -->
                            <input type="hidden" th:field="*{id}">

                            <div class="row g-3">
                                <!-- Código del Programa -->
                                <div class="col-md-4">
                                    <label for="codigo" class="form-label">
                                        Código <span class="text-danger">*</span>
                                    </label>
                                    <input type="text"
                                           class="form-control"
                                           th:field="*{codigo}"
                                           th:classappend="${#fields.hasErrors('codigo')} ? 'is-invalid' : ''"
                                           id="codigo"
                                           placeholder="TEC-001"
                                           required>
                                    <div class="invalid-feedback" th:if="${#fields.hasErrors('codigo')}" th:errors="*{codigo}">
                                        Error de código
                                    </div>
                                </div>

                                <!-- Nombre del Programa -->
                                <div class="col-md-8">
                                    <label for="nombre" class="form-label">
                                        Nombre del Programa <span class="text-danger">*</span>
                                    </label>
                                    <input type="text"
                                           class="form-control"
                                           th:field="*{nombre}"
                                           th:classappend="${#fields.hasErrors('nombre')} ? 'is-invalid' : ''"
                                           id="nombre"
                                           placeholder="Análisis y Desarrollo de Software"
                                           required>
                                    <div class="invalid-feedback" th:if="${#fields.hasErrors('nombre')}" th:errors="*{nombre}">
                                        Error de nombre
                                    </div>
                                </div>

                                <!-- Nivel -->
                                <div class="col-md-6">
                                    <label for="nivel" class="form-label">
                                        Nivel <span class="text-danger">*</span>
                                    </label>
                                    <select class="form-select"
                                            th:field="*{nivel}"
                                            th:classappend="${#fields.hasErrors('nivel')} ? 'is-invalid' : ''"
                                            id="nivel"
                                            required>
                                        <option value="">Seleccione un nivel</option>
                                        <option value="TÉCNICO">Técnico</option>
                                        <option value="TECNÓLOGO">Tecnólogo</option>
                                        <option value="ESPECIALIZACIÓN">Especialización</option>
                                        <option value="CURSO_CORTO">Curso Corto</option>
                                    </select>
                                    <div class="invalid-feedback" th:if="${#fields.hasErrors('nivel')}" th:errors="*{nivel}">
                                        Error de nivel
                                    </div>
                                </div>

                                <!-- Duración -->
                                <div class="col-md-6">
                                    <label for="duracion" class="form-label">
                                        Duración (meses) <span class="text-danger">*</span>
                                    </label>
                                    <input type="number"
                                           class="form-control"
                                           th:field="*{duracion}"
                                           th:classappend="${#fields.hasErrors('duracion')} ? 'is-invalid' : ''"
                                           id="duracion"
                                           placeholder="24"
                                           min="1"
                                           max="60"
                                           required>
                                    <div class="invalid-feedback" th:if="${#fields.hasErrors('duracion')}" th:errors="*{duracion}">
                                        Error de duración
                                    </div>
                                    <small class="form-text text-muted">Ingrese la duración en meses</small>
                                </div>

                                <!-- Estado -->
                                <div class="col-md-12">
                                    <label for="estado" class="form-label">
                                        Estado
                                    </label>
                                    <select class="form-select"
                                            th:field="*{estado}"
                                            id="estado">
                                        <option value="ACTIVO">Activo</option>
                                        <option value="INACTIVO">Inactivo</option>
                                        <option value="SUSPENDIDO">Suspendido</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Botones -->
                            <div class="d-flex justify-content-between mt-4 pt-3 border-top">
                                <a th:href="@{/programas}" class="btn btn-secondary">
                                    <i class="bi bi-x-circle"></i> Cancelar
                                </a>
                                <button type="submit" class="btn btn-sena">
                                    <i class="bi bi-save-fill"></i>
                                    <span th:text="${programa.id == null ? 'Crear Programa' : 'Guardar Cambios'}">Guardar</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Validación del formulario
        (function() {
            'use strict';
            var forms = document.querySelectorAll('form[novalidate]');
            Array.prototype.slice.call(forms).forEach(function(form) {
                form.addEventListener('submit', function(event) {
                    if (!form.checkValidity()) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        })();
    </script>
</body>
</html>
