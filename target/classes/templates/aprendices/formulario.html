<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(titulo=${accion + ' Aprendiz'}, contenido=~{::main})}"
      lang="es">
<body>
    <main>
        <!-- Encabezado -->
        <div class="mb-4">
            <h2>
                <i th:class="${aprendiz.id == null ? 'bi bi-person-plus-fill' : 'bi bi-pencil-fill'} + ' text-primary'"></i>
                <span th:text="${accion} + ' Aprendiz'">Crear Aprendiz</span>
            </h2>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a th:href="@{/}">Inicio</a></li>
                    <li class="breadcrumb-item"><a th:href="@{/aprendices}">Aprendices</a></li>
                    <li class="breadcrumb-item active" th:text="${accion}">Crear</li>
                </ol>
            </nav>
        </div>

        <!-- Formulario -->
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card border-0 shadow">
                    <div class="card-header card-header-sena">
                        <h5 class="mb-0">
                            <i class="bi bi-clipboard-data-fill"></i> Información del Aprendiz
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <form th:action="@{/aprendices/guardar}"
                              th:object="${aprendiz}"
                              method="post"
                              novalidate>

                            <!-- ID oculto (para edición) -->
                            <input type="hidden" th:field="*{id}">

                            <!-- Datos Personales -->
                            <h5 class="mb-3 text-primary">
                                <i class="bi bi-person-badge"></i> Datos Personales
                            </h5>

                            <div class="row g-3">
                                <!-- Tipo de Documento -->
                                <div class="col-md-3">
                                    <label for="tipoDocumento" class="form-label">
                                        Tipo Documento <span class="text-danger">*</span>
                                    </label>
                                    <select class="form-select"
                                            th:field="*{tipoDocumento}"
                                            th:classappend="${#fields.hasErrors('tipoDocumento')} ? 'is-invalid' : ''"
                                            id="tipoDocumento"
                                            required>
                                        <option value="">Seleccione</option>
                                        <option value="CC">Cédula de Ciudadanía</option>
                                        <option value="TI">Tarjeta de Identidad</option>
                                        <option value="CE">Cédula de Extranjería</option>
                                        <option value="PAS">Pasaporte</option>
                                    </select>
                                    <div class="invalid-feedback" th:if="${#fields.hasErrors('tipoDocumento')}" th:errors="*{tipoDocumento}">
                                        Error de tipo de documento
                                    </div>
                                </div>

                                <!-- Número de Documento -->
                                <div class="col-md-3">
                                    <label for="documento" class="form-label">
                                        Número Documento <span class="text-danger">*</span>
                                    </label>
                                    <input type="text"
                                           class="form-control"
                                           th:field="*{documento}"
                                           th:classappend="${#fields.hasErrors('documento')} ? 'is-invalid' : ''"
                                           id="documento"
                                           placeholder="1234567890"
                                           required>
                                    <div class="invalid-feedback" th:if="${#fields.hasErrors('documento')}" th:errors="*{documento}">
                                        Error de documento
                                    </div>
                                </div>

                                <!-- Nombres -->
                                <div class="col-md-6">
                                    <label for="nombres" class="form-label">
                                        Nombres <span class="text-danger">*</span>
                                    </label>
                                    <input type="text"
                                           class="form-control"
                                           th:field="*{nombres}"
                                           th:classappend="${#fields.hasErrors('nombres')} ? 'is-invalid' : ''"
                                           id="nombres"
                                           placeholder="Juan Carlos"
                                           required>
                                    <div class="invalid-feedback" th:if="${#fields.hasErrors('nombres')}" th:errors="*{nombres}">
                                        Error de nombres
                                    </div>
                                </div>

                                <!-- Apellidos -->
                                <div class="col-md-6">
                                    <label for="apellidos" class="form-label">
                                        Apellidos <span class="text-danger">*</span>
                                    </label>
                                    <input type="text"
                                           class="form-control"
                                           th:field="*{apellidos}"
                                           th:classappend="${#fields.hasErrors('apellidos')} ? 'is-invalid' : ''"
                                           id="apellidos"
                                           placeholder="Pérez Gómez"
                                           required>
                                    <div class="invalid-feedback" th:if="${#fields.hasErrors('apellidos')}" th:errors="*{apellidos}">
                                        Error de apellidos
                                    </div>
                                </div>

                                <!-- Email -->
                                <div class="col-md-6">
                                    <label for="correo" class="form-label">
                                        Email <span class="text-danger">*</span>
                                    </label>
                                    <input type="email"
                                           class="form-control"
                                           th:field="*{correo}"
                                           th:classappend="${#fields.hasErrors('correo')} ? 'is-invalid' : ''"
                                           id="correo"
                                           placeholder="correo@ejemplo.com"
                                           required>
                                    <div class="invalid-feedback" th:if="${#fields.hasErrors('correo')}" th:errors="*{correo}">
                                        Error de email
                                    </div>
                                </div>

                                <!-- Teléfono -->
                                <div class="col-md-4">
                                    <label for="telefono" class="form-label">
                                        Teléfono
                                    </label>
                                    <input type="tel"
                                           class="form-control"
                                           th:field="*{telefono}"
                                           th:classappend="${#fields.hasErrors('telefono')} ? 'is-invalid' : ''"
                                           id="telefono"
                                           placeholder="3001234567">
                                    <div class="invalid-feedback" th:if="${#fields.hasErrors('telefono')}" th:errors="*{telefono}">
                                        Error de teléfono
                                    </div>
                                </div>

                                <!-- Dirección -->
                                <div class="col-md-8">
                                    <label for="direccion" class="form-label">
                                        Dirección
                                    </label>
                                    <input type="text"
                                           class="form-control"
                                           th:field="*{direccion}"
                                           th:classappend="${#fields.hasErrors('direccion')} ? 'is-invalid' : ''"
                                           id="direccion"
                                           placeholder="Calle 123 #45-67">
                                    <div class="invalid-feedback" th:if="${#fields.hasErrors('direccion')}" th:errors="*{direccion}">
                                        Error de dirección
                                    </div>
                                </div>
                            </div>

                            <hr class="my-4">

                            <!-- Información Académica -->
                            <h5 class="mb-3 text-primary">
                                <i class="bi bi-book"></i> Información Académica
                            </h5>

                            <div class="row g-3">
                                <!-- Ficha -->
                                <div class="col-md-6">
                                    <label for="fichaId" class="form-label">
                                        Ficha <span class="text-danger">*</span>
                                    </label>
                                    <select class="form-select"
                                            name="fichaId"
                                            id="fichaId"
                                            required>
                                        <option value="">Seleccione una ficha</option>
                                        <option th:each="ficha : ${fichas}"
                                                th:value="${ficha.id}"
                                                th:text="${ficha.codigo + ' - ' + ficha.nombrePrograma}"
                                                th:selected="${aprendiz.ficha != null && aprendiz.ficha.id == ficha.id}">
                                            Ficha
                                        </option>
                                    </select>
                                    <div class="invalid-feedback">
                                        Debe seleccionar una ficha
                                    </div>
                                </div>

                                <!-- Estado -->
                                <div class="col-md-6">
                                    <label for="estado" class="form-label">
                                        Estado
                                    </label>
                                    <select class="form-select"
                                            th:field="*{estado}"
                                            id="estado">
                                        <option value="ACTIVO">Activo</option>
                                        <option value="INACTIVO">Inactivo</option>
                                        <option value="GRADUADO">Graduado</option>
                                        <option value="RETIRADO">Retirado</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Botones -->
                            <div class="d-flex justify-content-between mt-4 pt-3 border-top">
                                <a th:href="@{/aprendices}" class="btn btn-secondary">
                                    <i class="bi bi-x-circle"></i> Cancelar
                                </a>
                                <button type="submit" class="btn btn-sena">
                                    <i class="bi bi-save-fill"></i>
                                    <span th:text="${aprendiz.id == null ? 'Crear Aprendiz' : 'Guardar Cambios'}">Guardar</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Validación del formulario
        (function() {
            'use strict';
            var forms = document.querySelectorAll('form[novalidate]');
            Array.prototype.slice.call(forms).forEach(function(form) {
                form.addEventListener('submit', function(event) {
                    if (!form.checkValidity()) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        })();
    </script>
</body>
</html>
